# Настройка окружений для бота

## Обзор изменений

Бот теперь поддерживает использование разных токенов для разных окружений, что обеспечивает изоляцию между продакшеном и разработкой.

## Переменные окружения

### Токены ботов

- `BOT_TOKEN_PROD` - токен для продакшенового бота
- `BOT_TOKEN_DEV` - токен для девелоперского бота
- `BOT_TOKEN` - fallback токен (используется если специфичный токен не найден)

### Логика выбора токена

```typescript
if (NODE_ENV === 'production') {
    BOT_TOKEN = process.env.BOT_TOKEN_PROD || process.env.BOT_TOKEN || '';
} else {
    BOT_TOKEN = process.env.BOT_TOKEN_DEV || process.env.BOT_TOKEN || '';
}
```

## Режимы запуска

### Production (NODE_ENV=production)

- Использует `BOT_TOKEN_PROD`
- Запускается в режиме webhook
- Устанавливает webhook на указанный URL
- Обрабатывает rate limiting при установке webhook

### Development (NODE_ENV=development)

- Использует `BOT_TOKEN_DEV`
- Запускается в режиме polling
- **НЕ удаляет webhook** для безопасности продакшенового бота

## Важные изменения

### Безопасность webhook в development

Ранее в development режиме всегда выполнялся `bot.telegram.deleteWebhook()`, что могло повлиять на продакшеновый бот, если использовался тот же токен.

Теперь webhook не удаляется в development режиме, что обеспечивает:

- Безопасность продакшенового бота
- Возможность одновременной работы dev и prod ботов
- Отсутствие конфликтов между окружениями

## Настройка

### 1. Создание ботов

Создайте два отдельных бота через @BotFather:

1. Продакшеновый бот (например, `@your_prod_bot`)
2. Девелоперский бот (например, `@your_dev_bot`)

### 2. Настройка переменных окружения

#### Для локальной разработки (.env):

```bash
NODE_ENV=development
BOT_TOKEN_DEV=your_dev_bot_token_here
```

#### Для продакшена:

```bash
NODE_ENV=production
BOT_TOKEN_PROD=your_prod_bot_token_here
WEBHOOK_URL=https://yourdomain.com
WEBHOOK_PATH=/webhook
PORT=8080
```

### 3. Обратная совместимость

Если не указаны специфичные токены, бот будет использовать `BOT_TOKEN` как fallback:

```bash
# Старый способ (все еще работает)
BOT_TOKEN=your_bot_token_here
```

## Преимущества новой схемы

1. **Изоляция окружений** - разные боты для dev и prod
2. **Безопасность** - webhook продакшена не затрагивается в development
3. **Гибкость** - можно использовать один токен или разные
4. **Обратная совместимость** - старые настройки продолжают работать

## Логирование

Бот теперь выводит информацию о том, какой бот используется:

- `Используется продакшеновый бот` - в production
- `Используется девелоперский бот` - в development
